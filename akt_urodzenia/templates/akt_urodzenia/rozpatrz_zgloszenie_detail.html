{% extends "ogolne/base.html" %}
{% load crispy_forms_tags %}

{% block title %}Szczegóły zgłoszenia urodzenia{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Szczegóły zgłoszenia nr {{ zgloszenie.id }}</h2>
    <div class="card">
        <div class="card-body">
            <p><strong>Wnioskodawca:</strong> {{ zgloszenie.wnioskodawca.first_name }} {{ zgloszenie.wnioskodawca.last_name }}</p>
            <p><strong>Data złożenia:</strong> {{ zgloszenie.data_zlozenia }}</p>
            <p><strong>Status:</strong> {{ zgloszenie.get_status_display }}</p>
            <hr>
            <h4>Dane dziecka</h4>
            <p><strong>Imię i nazwisko:</strong> {{ zgloszenie.imie_dziecka }} {{ zgloszenie.nazwisko_dziecka }}</p>
            <p><strong>Płeć:</strong> {{ zgloszenie.get_plec_dziecka_display }}</p>
            <p><strong>Data i miejsce urodzenia:</strong> {{ zgloszenie.data_urodzenia_dziecka }} w {{ zgloszenie.miejsce_urodzenia_dziecka }}</p>
            {% if zgloszenie.pesel_dziecka %}
                <p><strong>Wygenerowany PESEL:</strong> {{ zgloszenie.pesel_dziecka }}</p>
            {% endif %}
            <hr>
            <h4>Dane rodziców</h4>
            <p><strong>Matka:</strong> {{ zgloszenie.imie_matki }} {{ zgloszenie.nazwisko_rodowe_matki }}</p>
            <p><strong>Ojciec:</strong> {{ zgloszenie.imie_ojca }} {{ zgloszenie.nazwisko_ojca }}</p>

            {% if zgloszenie.uzasadnienie_odrzucenia %}
                <div class="alert alert-danger mt-3">
                    <strong>Powód odrzucenia:</strong> {{ zgloszenie.uzasadnienie_odrzucenia }}
                </div>
            {% endif %}
        </div>
    </div>

    {% if perms.akt_urodzenia.change_zgloszenieurodzenia and zgloszenie.status == 'Złożony' %}
        <div class="mt-4">
            <h3>Operacje</h3>
            <form method="post">
                {% csrf_token %}
                {{ form|crispy }}
                <button type="submit" name="action" value="accept" class="btn btn-success">Zaakceptuj i wygeneruj PESEL</button>
                <button type="submit" name="action" value="reject" class="btn btn-danger">Odrzuć</button>
            </form>
        </div>
    {% endif %}

    <a href="{% if perms.akt_urodzenia.view_zgloszenieurodzenia %}{% url 'akt_urodzenia:lista_zgloszen' %}{% else %}{% url 'ogolne:moje_wnioski' %}{% endif %}" class="btn btn-secondary mt-3">Powrót</a>
</div>
{% endblock %}